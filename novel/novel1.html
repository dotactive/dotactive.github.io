<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Novel 1</title>
  <style>
    #novel-menu {
      position: fixed;
      top: 0;
      left: 0;
      width: 200px;
      padding: 10px;
    }

    #novel-content {
      margin-left: 220px;
      padding: 10px;
    }
  </style>
</head>
<body>
  <div id="novel-menu">
    <h2>Novel Menu</h2>
    <ul id="novel-list"></ul>
  </div>
  <div id="novel-content"></div>

  <script>
    function fetchTextFiles() {
      var novelList = document.getElementById("novel-list");
      var novelContent = document.getElementById("novel-content");

      // Fetch the list of text files
      fetch("https://raw.githubusercontent.com/pinktit/buried-seed/main/files.json")
        .then(function(response) {
          return response.json();
        })
        .then(function(data) {
          // Get the list of file names
          var fileNames = data.files;

          // Create an object to store the text file content
          var textFileContent = {};

          // Loop through the file names
          fileNames.forEach(function(fileName) {
            // Fetch each text file
            fetch("https://raw.githubusercontent.com/pinktit/buried-seed/main/" + fileName)
              .then(function(response) {
                return response.text();
              })
              .then(function(fileContent) {
                // Store the text file content in the object using the file name as the key
                textFileContent[fileName] = fileContent;

                // Check if all files have been fetched
                if (Object.keys(textFileContent).length === fileNames.length) {
                  // Sort the file names by their ID
                  fileNames.sort(function(a, b) {
                    var idA = parseInt(a.replace(/[^0-9]/g, ""), 10);
                    var idB = parseInt(b.replace(/[^0-9]/g, ""), 10);
                    return idA - idB;
                  });

                  // Render the navigation menu and text content
                  renderNovelContent(fileNames, textFileContent);
                }
              })
              .catch(function(error) {
                console.log("Error fetching " + fileName + ": " + error);
              });
          });
        })
        .catch(function(error) {
          console.log("Error fetching file names: " + error);
        });
    }

    function renderNovelContent(fileNames, textFileContent) {
      var novelList = document.getElementById("novel-list");
      var novelContent = document.getElementById("novel-content");

      // Loop through the sorted file names
      fileNames.forEach(function(fileName) {
        var listItem = document.createElement("li");
        var link = document.createElement("a");
        link.textContent = fileName.replace(".txt", "");
        link.href = "#" + fileName.replace(".txt", "");
        listItem.appendChild(link);
        novelList.appendChild(listItem);

        var anchor = document.createElement("a");
        anchor.id = fileName.replace(".txt", "");
        novelContent.appendChild(anchor);

        var paragraphs = textFileContent[fileName].split("\n");
        paragraphs.forEach(function(paragraphText) {
          var paragraph = document.createElement("p");
          paragraph.textContent = paragraphText;
          anchor.appendChild(paragraph);
        });
      });
    }

    fetchTextFiles();
  </script>
</body>
</html>
